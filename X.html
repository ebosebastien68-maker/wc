<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bulk Reactions â€” WorldConnect</title>
<style>
  body{font-family:Inter,system-ui,Arial; background:linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; padding:24px; color:#111}
  .card{max-width:900px;margin:0 auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.1)}
  input,button{font-size:15px;padding:10px;border-radius:8px;border:1px solid #ddd}
  button{background:#11998e;color:#fff;border:none;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .result{margin-top:12px;padding:12px;border-radius:8px;display:none}
  .ok{background:#e6ffed;border-left:4px solid #28a745}
  .err{background:#fff0f0;border-left:4px solid #dc3545}
</style>
</head>
<body>
  <div class="card">
    <h2>Ajout de RÃ©actions â€” BULK</h2>
    <label>Article ID</label><input id="articleId" type="text" placeholder="ee2abbde-..." />
    <div class="grid" style="margin-top:12px">
      <div><label>ğŸ‘ Like</label><input id="like" type="number" value="0" min="0" /></div>
      <div><label>â¤ï¸ Love</label><input id="love" type="number" value="0" min="0" /></div>
      <div><label>ğŸ˜† Rire</label><input id="rire" type="number" value="0" min="0" /></div>
      <div><label>ğŸ˜¡ ColÃ¨re</label><input id="colere" type="number" value="0" min="0" /></div>
    </div>
    <div style="margin-top:12px">
      <button id="runBtn">ğŸš€ ExÃ©cuter</button>
    </div>

    <div id="result" class="result"></div>
  </div>

<script>
const EDGE_URL = "https://eqnvbmkdrnssbiwalocr.supabase.co/functions/v1/add-reactions-bulk-";
// Remplace ici par ta clÃ© ANON publique ou configure ton deploy pour injecter
const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxbnZibWtkcm5zc2Jpd2Fsb2NyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MzY1MzcsImV4cCI6MjA4MDMxMjUzN30.EFDSrgAbN5wpIYKD-8srH3mtdHZvm81gzjiqsELgCvY";

const btn = document.getElementById("runBtn");
const result = document.getElementById("result");

function show(success, html){
  result.style.display = "block";
  result.className = "result " + (success ? "ok":"err");
  result.innerHTML = html;
}

btn.addEventListener("click", async () => {
  result.style.display = "none";
  const article_id = document.getElementById("articleId").value.trim();
  const like = Number(document.getElementById("like").value) || 0;
  const love = Number(document.getElementById("love").value) || 0;
  const rire = Number(document.getElementById("rire").value) || 0;
  const colere = Number(document.getElementById("colere").value) || 0;

  if (!article_id) { alert("Article ID requis"); return; }
  if (like+love+rire+colere === 0) { alert("Entrez au moins une rÃ©action"); return; }

  btn.disabled = true;
  btn.textContent = "â³ En cours...";

  try {
    const resp = await fetch(EDGE_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": ANON_KEY,
        "Authorization": `Bearer ${ANON_KEY}`
      },
      body: JSON.stringify({ article_id, reactions: { like, love, rire, colere } })
    });

    if (!resp.ok) {
      const text = await resp.text().catch(()=>"");
      throw new Error(`HTTP ${resp.status} ${resp.statusText} ${text ? " - "+text : ""}`);
    }

    const json = await resp.json();
    show(true, `SuccÃ¨s â€” ${json.total_added||0} rÃ©actions ajoutÃ©es<br/><pre>${JSON.stringify(json.added,null,2)}</pre>`);

  } catch (err) {
    console.error(err);
    show(false, "Erreur : " + (err.message || String(err)));
  } finally {
    btn.disabled = false;
    btn.textContent = "ğŸš€ ExÃ©cuter";
  }
});
</script>
</body>
</html>
