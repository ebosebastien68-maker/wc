<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contr√¥le des R√©actions Simul√©es - BULK</title>
<style>
/* --- Styles simplifi√©s mais conserv√©s --- */
body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
.container { max-width: 800px; margin: auto; }
h1 { color: #333; margin-bottom: 20px; }
input { width: 100%; padding: 10px; margin-bottom: 15px; }
button { padding: 15px; width: 100%; background: #667eea; color: white; border: none; cursor: pointer; }
button:disabled { background: #ccc; cursor: not-allowed; }
.result-box { margin-top: 20px; padding: 15px; border-radius: 10px; display: none; }
.result-box.success { background: #d4edda; color: #155724; }
.result-box.error { background: #f8d7da; color: #721c24; }
</style>
</head>
<body>

<div class="container">
    <h1>üöÄ Ajout de R√©actions BULK</h1>
    <label>üìù Article ID</label>
    <input type="text" id="articleIdInput" placeholder="ex: abc123-def456-ghi789" />

    <label>üëç Like</label>
    <input type="number" id="likeNumber" value="0" min="0" />

    <label>‚ù§Ô∏è Love</label>
    <input type="number" id="loveNumber" value="0" min="0" />

    <label>üòÜ Rire</label>
    <input type="number" id="rireNumber" value="0" min="0" />

    <label>üò° Col√®re</label>
    <input type="number" id="colereNumber" value="0" min="0" />

    <button id="executeBtn">üöÄ EX√âCUTER TOUT</button>

    <div class="result-box" id="resultBox">
        <div id="resultContent"></div>
    </div>
</div>

<script>
// --- Configuration Supabase Edge Function ---
const EDGE_FUNCTION_URL = 'https://eqnvbmkdrnssbiwalocr.supabase.co/functions/v1/add-reactions-bulk-';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxbnZibWtkcm5zc2Jpd2Fsb2NyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MzY1MzcsImV4cCI6MjA4MDMxMjUzN30.EFDSrgAbN5wpIYKD-8srH3mtdHZvm81gzjiqsELgCvY';

async function executeBulkAdd() {
    const articleId = document.getElementById('articleIdInput').value.trim();
    const like = parseInt(document.getElementById('likeNumber').value) || 0;
    const love = parseInt(document.getElementById('loveNumber').value) || 0;
    const rire = parseInt(document.getElementById('rireNumber').value) || 0;
    const colere = parseInt(document.getElementById('colereNumber').value) || 0;

    if (!articleId) { alert('Veuillez saisir un Article ID'); return; }
    if (like + love + rire + colere === 0) { alert('Veuillez saisir au moins une r√©action'); return; }

    const btn = document.getElementById('executeBtn');
    btn.disabled = true;

    const resultBox = document.getElementById('resultBox');
    const resultContent = document.getElementById('resultContent');
    resultBox.style.display = 'none';

    try {
        const response = await fetch(EDGE_FUNCTION_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            },
            body: JSON.stringify({
                article_id: articleId,
                reactions: { like, love, rire, colere }
            })
        });

        const result = await response.json();

        if (result.success) {
            resultBox.className = 'result-box success';
            resultBox.style.display = 'block';
            resultContent.innerHTML = `
                ‚úÖ ${result.total_added} r√©actions ajout√©es !
                <br>üëç Likes: ${result.added.like} | ‚ù§Ô∏è Loves: ${result.added.love} | üòÜ Rires: ${result.added.rire} | üò° Col√®res: ${result.added.colere}
            `;
        } else {
            resultBox.className = 'result-box error';
            resultBox.style.display = 'block';
            resultContent.innerHTML = `‚ùå Erreur : ${result.error || 'Inconnue'}`;
        }
    } catch (error) {
        resultBox.className = 'result-box error';
        resultBox.style.display = 'block';
        resultContent.innerHTML = `‚ùå Erreur r√©seau : ${error.message}`;
    } finally {
        btn.disabled = false;
    }
}

document.getElementById('executeBtn').addEventListener('click', executeBulkAdd);
</script>

</body>
</html>
